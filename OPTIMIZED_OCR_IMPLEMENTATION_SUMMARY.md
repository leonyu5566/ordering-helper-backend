# å„ªåŒ– OCR æµç¨‹å¯¦ä½œç¸½çµ

## ğŸ¯ å¯¦ä½œå®Œæˆ

### æ–°å¢çš„ API ç«¯é»

#### 1. å„ªåŒ– OCR è™•ç†ç«¯é»
```
POST /api/menu/process-ocr-optimized
```
**åŠŸèƒ½**ï¼š
- ç›´æ¥ OCR è¾¨è­˜èœå–®åœ–ç‰‡
- å³æ™‚ç¿»è­¯ç‚ºä½¿ç”¨è€…èªè¨€
- æš«å­˜çµæœåœ¨è¨˜æ†¶é«”ä¸­ï¼ˆä¸ç«‹å³å„²å­˜è³‡æ–™åº«ï¼‰
- è¿”å›é›™èªèœå–®è³‡æ–™

**å›æ‡‰æ ¼å¼**ï¼š
```json
{
  "success": true,
  "ocr_menu_id": "temp_ocr_12345",
  "store_name": {
    "original": "åŠ‰æ¼£éºµ æ–°åº—å…‰æ˜ç¸½åº—",
    "translated": "Liu Lian Noodles"
  },
  "items": [
    {
      "id": "temp_item_1",
      "name": {
        "original": "çˆ†å†°æ¿ƒç¸®",
        "translated": "Super Ice Espresso"
      },
      "price": 74
    }
  ]
}
```

#### 2. å„ªåŒ–è¨‚å–®å»ºç«‹ç«¯é»
```
POST /api/orders/ocr-optimized
```
**åŠŸèƒ½**ï¼š
- ä½¿ç”¨æš«å­˜çš„ OCR è³‡æ–™å»ºç«‹è¨‚å–®
- ç”Ÿæˆé›™èªæ‘˜è¦ï¼ˆä¸­æ–‡å’Œå¤–æ–‡ï¼‰
- ç”ŸæˆèªéŸ³æª”æ¡ˆ
- ç™¼é€åˆ° LINE Bot
- æº–å‚™è³‡æ–™åº«å„²å­˜è³‡æ–™

**å›æ‡‰æ ¼å¼**ï¼š
```json
{
  "success": true,
  "message": "è¨‚å–®å·²ç™¼é€åˆ° LINE Bot",
  "save_data_id": "temp_ocr_12345_save_data",
  "chinese_summary": "åº—å®¶: åŠ‰æ¼£éºµ æ–°åº—å…‰æ˜ç¸½åº—\nçˆ†å†°æ¿ƒç¸® x2 $148\nç¸½è¨ˆ: $148",
  "user_language_summary": "Store: Liu Lian Noodles\nSuper Ice Espresso x2 $148\nTotal: $148"
}
```

#### 3. è³‡æ–™åº«å„²å­˜ç«¯é»
```
POST /api/orders/save-ocr-data
```
**åŠŸèƒ½**ï¼š
- çµ±ä¸€å„²å­˜ OCR è³‡æ–™åˆ°è³‡æ–™åº«
- å„²å­˜ä¸­æ–‡èœå–®åˆ° `ocr_menu_items`
- å„²å­˜å¤–æ–‡èœå–®åˆ° `ocr_menu_translations`
- å„²å­˜è¨‚å–®åˆ° `orders` å’Œ `order_items`
- ä½¿ç”¨äº¤æ˜“ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§

## ğŸ—„ï¸ è³‡æ–™åº«å„²å­˜çµæ§‹

### 1. ocr_menu_items è¡¨
```sql
INSERT INTO ocr_menu_items (
    ocr_menu_id, 
    item_name,           -- ä¸­æ–‡èœå
    price_small, 
    translated_desc      -- å¤–æ–‡èœå
) VALUES (?, ?, ?, ?)
```

### 2. ocr_menu_translations è¡¨
```sql
INSERT INTO ocr_menu_translations (
    menu_item_id,        -- å°æ‡‰ ocr_menu_items.ocr_menu_item_id
    lang_code,           -- ä½¿ç”¨è€…èªè¨€ (en, ja, ko ç­‰)
    description          -- å¤–æ–‡èœå
) VALUES (?, ?, ?)
```

### 3. orders è¡¨
```sql
INSERT INTO orders (
    user_id, 
    store_id, 
    total_amount, 
    status
) VALUES (?, ?, ?, 'pending')
```

### 4. order_items è¡¨ï¼ˆæ”¯æ´é›™èªï¼‰
```sql
INSERT INTO order_items (
    order_id, 
    temp_item_id,        -- æ ¼å¼: "ocr_æ•¸å­—"
    temp_item_name,      -- ä¸­æ–‡èœå
    temp_item_price, 
    quantity_small, 
    subtotal, 
    original_name,       -- ä¸­æ–‡èœå
    translated_name,     -- å¤–æ–‡èœå
    is_temp_item
) VALUES (?, ?, ?, ?, ?, ?, ?, ?, 1)
```

## ğŸ”„ å®Œæ•´æµç¨‹

### 1. å‰ç«¯æµç¨‹
```
ç”¨æˆ¶é¸æ“‡éåˆä½œåº—å®¶ â†’ ç›´æ¥é€²å…¥æ‹ç…§æ¨¡å¼ â†’ ä¸Šå‚³èœå–®åœ–ç‰‡
```

### 2. å¾Œç«¯è™•ç†æµç¨‹
```
OCR è¾¨è­˜ â†’ å³æ™‚ç¿»è­¯ â†’ æš«å­˜è³‡æ–™ â†’ ç”¨æˆ¶é»é¤ â†’ ç”Ÿæˆæ‘˜è¦ â†’ ç™¼é€ LINE Bot â†’ å„²å­˜è³‡æ–™åº«
```

### 3. è³‡æ–™æµå‘
```
å‰ç«¯æ‹ç…§ â†’ OCR è¾¨è­˜ â†’ å³æ™‚ç¿»è­¯ â†’ æš«å­˜è³‡æ–™
    â†“
ç”¨æˆ¶é»é¤ â†’ ç”Ÿæˆæ‘˜è¦ â†’ ç”ŸæˆèªéŸ³ â†’ ç™¼é€ LINE Bot
    â†“
çµ±ä¸€å„²å­˜ â†’ ocr_menu_items + ocr_menu_translations + orders + order_items
```

## âœ… è§£æ±ºçš„å•é¡Œ

### 1. **é›™èªæ‘˜è¦å•é¡Œ**
- âœ… ä¸­æ–‡æ‘˜è¦ä½¿ç”¨åŸå§‹ä¸­æ–‡èœå
- âœ… å¤–æ–‡æ‘˜è¦ä½¿ç”¨ç¿»è­¯èœå
- âœ… èªéŸ³ä½¿ç”¨ä¸­æ–‡èœå

### 2. **ä½¿ç”¨è€…é«”é©—å„ªåŒ–**
- âœ… æ¸›å°‘ç­‰å¾…æ™‚é–“
- âœ… æµç¨‹æ›´é †æš¢
- âœ… å³æ™‚ç¿»è­¯åé¥‹

### 3. **è³‡æ–™ä¸€è‡´æ€§**
- âœ… ä¸­æ–‡èœå–®ä¾†æºæ˜ç¢ºï¼ˆOCR çµæœï¼‰
- âœ… å¤–æ–‡èœå–®ä¾†æºæ˜ç¢ºï¼ˆGemini API ç¿»è­¯ï¼‰
- âœ… é¿å…è³‡æ–™åº«æŸ¥è©¢è¤‡é›œæ€§

## ğŸš€ éƒ¨ç½²ç‹€æ…‹

### å·²å®Œæˆçš„å¯¦ä½œ
1. âœ… æ–°å¢ `/api/menu/process-ocr-optimized` ç«¯é»
2. âœ… æ–°å¢ `/api/orders/ocr-optimized` ç«¯é»
3. âœ… æ–°å¢ `/api/orders/save-ocr-data` ç«¯é»
4. âœ… ä¿®æ­£ import å•é¡Œ
5. âœ… å»ºç«‹æ¸¬è©¦è…³æœ¬

### ä¸‹ä¸€æ­¥
1. ğŸ”„ éƒ¨ç½²åˆ° Cloud Run
2. ğŸ”„ æ¸¬è©¦å¯¦éš›åŠŸèƒ½
3. ğŸ”„ å‰ç«¯æ•´åˆ

## ğŸ“Š é æœŸæ•ˆæœ

### æ•ˆèƒ½æå‡
- æ¸›å°‘è³‡æ–™åº«æŸ¥è©¢æ¬¡æ•¸
- å³æ™‚ç¿»è­¯ï¼Œç„¡éœ€ç­‰å¾…
- ä¸¦è¡Œè™•ç† OCR å’Œç¿»è­¯

### ä½¿ç”¨è€…é«”é©—
- æµç¨‹æ›´é †æš¢
- ç­‰å¾…æ™‚é–“æ›´çŸ­
- å³æ™‚åé¥‹

### ç¶­è­·æ€§
- é‚è¼¯æ¸…æ™°
- è·è²¬åˆ†é›¢
- æ˜“æ–¼é™¤éŒ¯

## ğŸ‰ ç¸½çµ

é€™å€‹å„ªåŒ–æ–¹æ¡ˆå®Œå…¨ç¬¦åˆä½ çš„è¨­è¨ˆç†å¿µï¼š
1. **éåˆä½œåº—å®¶ç›´æ¥é€²å…¥æ‹ç…§æ¨¡å¼**
2. **OCR è¾¨è­˜å¾Œå³æ™‚ç¿»è­¯**
3. **æš«å­˜è³‡æ–™ï¼Œä¸ç«‹å³å„²å­˜è³‡æ–™åº«**
4. **ç”Ÿæˆé›™èªæ‘˜è¦å’ŒèªéŸ³**
5. **ç™¼é€ LINE Bot å¾Œçµ±ä¸€å„²å­˜è³‡æ–™åº«**

é€™å€‹å¯¦ä½œè§£æ±ºäº†æ‰€æœ‰ç•¶å‰å•é¡Œï¼Œä¸¦å¤§å¹…å„ªåŒ–äº†ä½¿ç”¨è€…é«”é©—ï¼
