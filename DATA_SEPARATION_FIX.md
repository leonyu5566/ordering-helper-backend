# è³‡æ–™åˆ†é›¢ä¿®æ­£ç¸½çµ

## å•é¡Œåˆ†æ

å¾åœ–ç‰‡å’Œæ—¥èªŒåˆ†æç™¼ç¾ï¼ŒåŸæœ¬çš„é›™èªåŠŸèƒ½å­˜åœ¨ã€Œå…©ä»½æ‘˜è¦è£¡å“åéƒ½è®Šä¸­æ–‡ã€åº—åéƒ½è®Šè‹±æ–‡ã€çš„å•é¡Œï¼š

### ç—‡ç‹€
- **ä¸­æ–‡æ‘˜è¦**ï¼šåº—åå’Œå“åéƒ½ä½¿ç”¨ä¸­æ–‡ âœ…
- **è‹±æ–‡æ‘˜è¦**ï¼šåº—åä½¿ç”¨è‹±æ–‡ï¼Œä½†å“åä»ä½¿ç”¨ä¸­æ–‡ âŒ
- **èªéŸ³ç”Ÿæˆ**ï¼šä½¿ç”¨ä¸­æ–‡åŸæ–‡ âœ…

### æ ¹æœ¬åŸå› 
åœ¨ç”Ÿæˆä½¿ç”¨è€…èªè¨€æ‘˜è¦æ™‚ï¼Œ**åŸæ–‡/è­¯æ–‡æ¬„ä½è¢«å…±ç”¨æˆ–è¦†è“‹**ï¼Œå°è‡´ï¼š
1. ç”¢ç”Ÿã€Œä¸­æ–‡æ‘˜è¦ã€å‰å°±æŠŠ `store_name` æ›¿æ›æˆäº†è‹±æ–‡è­¯å
2. ç”¢ç”Ÿã€Œä½¿ç”¨è€…èªè¨€æ‘˜è¦ã€æ™‚ï¼Œç”¨ä¾†çµ„è£å“åçš„é™£åˆ—æ˜¯ä¸­æ–‡å“åçš„é‚£ä¸€ä»½
3. åŒä¸€ä»½ `items` è¢«ä¸åŒæ­¥æ”¹å¯«ï¼Œé€ æˆäº¤å‰æ±¡æŸ“

## ä¿®æ­£æ–¹æ¡ˆ

### æ ¸å¿ƒåŸå‰‡
1. **æ°¸é ä¿ç•™ã€ŒåŸæ–‡ã€èˆ‡ã€Œç›®æ¨™èªè¨€ã€å…©ä»½ç¨ç«‹è³‡æ–™**ï¼ˆæ·±æ‹·è²ï¼Œä¸èƒ½å…±ç”¨ç‰©ä»¶ï¼‰
2. **åœ¨æœ€å¾Œçµ„è£è¨Šæ¯/èªéŸ³æ™‚æ‰æ±ºå®šè¦ç”¨å“ªä¸€ä»½**ï¼Œä¸è¦åœ¨å…±äº«è®Šæ•¸ä¸Šã€Œå°±åœ°ç¿»è­¯ã€

### 1. å®Œå…¨åˆ†é›¢è³‡æ–™æµ

```python
# å»ºç«‹è¨‚å–®æ‘˜è¦ DTOï¼ˆå®Œå…¨åˆ†é›¢ native å’Œ display è³‡æ–™æµï¼‰
# native è³‡æ–™ï¼šç”¨æ–¼ä¸­æ–‡æ‘˜è¦å’ŒèªéŸ³ï¼ˆæ·±æ‹·è²ï¼Œé¿å…å…±ç”¨ç‰©ä»¶ï¼‰
order_summary_native = OrderSummaryDTO(
    store_name=store_name_for_display,  # ä¸­æ–‡åº—å
    items=order_items_dto.copy() if hasattr(order_items_dto, 'copy') else order_items_dto,  # æ·±æ‹·è²é¿å…å…±ç”¨
    total_amount=order.total_amount,
    user_language='zh'  # å¼·åˆ¶ä½¿ç”¨ä¸­æ–‡
)

# display è³‡æ–™ï¼šç”¨æ–¼ä½¿ç”¨è€…èªè¨€æ‘˜è¦ï¼ˆæ·±æ‹·è²ï¼Œé¿å…å…±ç”¨ç‰©ä»¶ï¼‰
order_summary_display = OrderSummaryDTO(
    store_name=store_name_for_display,  # æœƒæ ¹æ“šèªè¨€ç¿»è­¯
    items=order_items_dto.copy() if hasattr(order_items_dto, 'copy') else order_items_dto,  # æ·±æ‹·è²é¿å…å…±ç”¨
    total_amount=order.total_amount,
    user_language=user_language
)
```

### 2. å„è‡ªæ¸²æŸ“è¨Šæ¯

```python
# ç”Ÿæˆé›™èªæ‘˜è¦ï¼ˆæ˜ç¢ºåˆ†é›¢è³‡æ–™æµï¼‰
chinese_summary = order_summary_native.chinese_summary
user_language_summary = order_summary_display.user_language_summary
chinese_voice_text = order_summary_native.voice_text
```

### 3. çµæ§‹åŒ–æ—¥èªŒé©—è­‰

```python
# è¨˜éŒ„çµæ§‹åŒ–æ—¥èªŒï¼Œé©—è­‰è³‡æ–™åˆ†é›¢
print(f"ğŸ“Š è³‡æ–™åˆ†é›¢é©—è­‰:")
print(f"   native store_name: '{store_name_for_display}'")
print(f"   native first item: '{order_items_dto[0].name.original if order_items_dto else 'N/A'}'")
print(f"   display user_lang: '{user_language}'")
print(f"   display first item: '{order_items_dto[0].name.translated if order_items_dto else 'N/A'}'")

# é©—è­‰è³‡æ–™åˆ†é›¢
print(f"âœ… è³‡æ–™åˆ†é›¢é©—è­‰:")
print(f"   - ä¸­æ–‡æ‘˜è¦ä½¿ç”¨ native åº—å: {'âœ“' if store_name_for_display in chinese_summary else 'âœ—'}")
print(f"   - ä½¿ç”¨è€…èªè¨€æ‘˜è¦ä½¿ç”¨ display åº—å: {'âœ“' if translated_store_name in user_language_summary else 'âœ—'}")
print(f"   - èªéŸ³ä½¿ç”¨ä¸­æ–‡åŸæ–‡: {'âœ“' if 'æ‹›ç‰Œé‡‘æ¹¯é…¸èœ' in chinese_voice_text or 'ç™½æ¿ƒé›æ¹¯' in chinese_voice_text else 'âœ—'}")
```

## æ¸¬è©¦çµæœ

### è‹±æ–‡ä½¿ç”¨è€… (en)
```
ä¸­æ–‡æ‘˜è¦:
åº—å®¶ï¼šé£Ÿè‚†é‹
è¨‚è³¼é …ç›®ï¼š
- æ‹›ç‰Œé‡‘æ¹¯é…¸èœ x1
- ç™½æ¿ƒé›æ¹¯ x1
ç¸½é‡‘é¡ï¼š$117

ä½¿ç”¨è€…èªè¨€æ‘˜è¦:
Store: Restaurant Hot Pot
Items:
- Signature Golden Soup Pickled Cabbage x1 ($68)
- White Thick Chicken Soup x1 ($49)
Total: $117

èªéŸ³æ–‡å­—:
è€é—†ï¼Œæˆ‘è¦æ‹›ç‰Œé‡‘æ¹¯é…¸èœä¸€ä»½ã€ç™½æ¿ƒé›æ¹¯ä¸€ä»½ï¼Œè¬è¬ã€‚
```

### é©—è­‰çµæœ
- âœ… ä¸­æ–‡æ‘˜è¦ä½¿ç”¨ native åº—å
- âœ… ä¸­æ–‡æ‘˜è¦ä½¿ç”¨ native å“å
- âœ… ä½¿ç”¨è€…èªè¨€æ‘˜è¦ä½¿ç”¨ display åº—å
- âœ… ä½¿ç”¨è€…èªè¨€æ‘˜è¦ä½¿ç”¨ display å“å
- âœ… èªéŸ³ä½¿ç”¨ä¸­æ–‡åŸæ–‡

### è³‡æ–™åˆ†é›¢æª¢æŸ¥
- âœ… åº—åæ˜¯å¦åˆ†é›¢ï¼š`é£Ÿè‚†é‹` vs `Restaurant Hot Pot`
- âœ… å“åæ˜¯å¦åˆ†é›¢ï¼š`æ‹›ç‰Œé‡‘æ¹¯é…¸èœ` vs `Signature Golden Soup Pickled Cabbage`

## ä¿®æ­£æ•ˆæœ

### âœ… å·²è§£æ±ºçš„å•é¡Œ
1. **è³‡æ–™æµå®Œå…¨åˆ†é›¢**ï¼šnative å’Œ display å…©å¥—è³‡æ–™å®Œå…¨ç¨ç«‹
2. **é˜²æ­¢å°±åœ°ä¿®æ”¹**ï¼šé¿å…å…±äº«ç‰©ä»¶è¢«æ„å¤–ä¿®æ”¹
3. **ä¸­æ–‡æ‘˜è¦ä¸€è‡´æ€§**ï¼šå§‹çµ‚ä½¿ç”¨ä¸­æ–‡åº—åå’Œå“å
4. **ä½¿ç”¨è€…èªè¨€æ‘˜è¦æ­£ç¢ºæ€§**ï¼šæ ¹æ“šèªè¨€æ­£ç¢ºé¡¯ç¤ºç¿»è­¯
5. **èªéŸ³ç”Ÿæˆç©©å®šæ€§**ï¼šå§‹çµ‚ä½¿ç”¨ä¸­æ–‡åŸæ–‡
6. **çµæ§‹åŒ–æ—¥èªŒ**ï¼šä¾¿æ–¼ Cloud Run æ—¥èªŒåˆ†æ

### ğŸ“Š é©—è­‰çµæœ
- âœ… ä¸­æ–‡æ‘˜è¦ä½¿ç”¨ native åº—åå’Œå“å
- âœ… ä½¿ç”¨è€…èªè¨€æ‘˜è¦ä½¿ç”¨ display åº—åå’Œå“å
- âœ… èªéŸ³ä½¿ç”¨ä¸­æ–‡åŸæ–‡
- âœ… è³‡æ–™å®Œå…¨åˆ†é›¢ï¼Œç„¡äº¤å‰æ±¡æŸ“
- âœ… é˜²æ­¢å°±åœ°ä¿®æ”¹
- âœ… é›¶è³‡æ–™åº«æ”¹å‹•

## éƒ¨ç½²èªªæ˜

### ä¿®æ”¹æª”æ¡ˆ
1. **`app/api/dto_models.py`** - å„ªåŒ–æ‘˜è¦ç”Ÿæˆé‚è¼¯
2. **`app/api/helpers.py`** - å®Œå…¨åˆ†é›¢ native å’Œ display è³‡æ–™æµ
3. **`app/api/routes.py`** - æ–°å¢ name_native æ¬„ä½

### æ¸¬è©¦é©—è­‰
```bash
python3 test_data_separation.py
```

### é æœŸæ•ˆæœ
- ä¸­æ–‡æ‘˜è¦ï¼šåº—åå’Œå“åéƒ½æ˜¯ä¸­æ–‡
- è‹±æ–‡æ‘˜è¦ï¼šåº—åæ˜¯è‹±æ–‡ï¼Œå“åæ˜¯è‹±æ–‡
- èªéŸ³ï¼šå§‹çµ‚ä½¿ç”¨ä¸­æ–‡åŸæ–‡
- è³‡æ–™åº«ï¼šå®Œå…¨ä¸éœ€è¦ä¿®æ”¹

## æŠ€è¡“è¦é»

1. **æ·±æ‹·è²é¿å…å…±ç”¨**ï¼šä½¿ç”¨ `.copy()` ç¢ºä¿ç‰©ä»¶ç¨ç«‹
2. **å¼·åˆ¶èªè¨€æ§åˆ¶**ï¼šä¸­æ–‡æ‘˜è¦å¼·åˆ¶ä½¿ç”¨ zh èªè¨€
3. **çµæ§‹åŒ–æ—¥èªŒ**ï¼šä¾¿æ–¼ Cloud Run æ—¥èªŒåˆ†æ
4. **é˜²æ­¢å°±åœ°ä¿®æ”¹**ï¼šé¿å…å…±äº«è®Šæ•¸è¢«æ„å¤–ä¿®æ”¹
5. **é›¶è³‡æ–™åº«æ”¹å‹•**ï¼šå®Œå…¨åœ¨æ‡‰ç”¨å±¤è™•ç†

## å¸¸è¦‹é™·é˜±é˜²è­·

1. **å°±åœ°ç¿»è­¯ï¼ˆin-place mutationï¼‰**
   - é¿å…ç›´æ¥åœ¨ `items` ä¸Š `item["name"] = translated_name`
   - ä½¿ç”¨æ·±æ‹·è²å»ºç«‹ç¨ç«‹ç‰©ä»¶

2. **èªç³»åˆ¤æ–·è¦†è“‹**
   - ç¢ºä¿ `user_lang` ä¾†æºæ­£ç¢º
   - é¿å…é è¨­å€¼è¨­å¤ªæ—©

3. **å…±äº«ç‰©ä»¶æ±¡æŸ“**
   - ä½¿ç”¨ `.copy()` å»ºç«‹ç¨ç«‹å‰¯æœ¬
   - é©—è­‰è³‡æ–™åˆ†é›¢

é€™å€‹ä¿®æ­£ç¢ºä¿äº†é›™èªåŠŸèƒ½çš„ç©©å®šæ€§å’Œä¸€è‡´æ€§ï¼Œå¾¹åº•è§£æ±ºäº†ã€Œå…©ä»½æ‘˜è¦è£¡å“åéƒ½è®Šä¸­æ–‡ã€åº—åéƒ½è®Šè‹±æ–‡ã€çš„å•é¡Œã€‚
